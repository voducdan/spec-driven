<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Connections</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
        }
        
        .debug-container {
            position: relative;
            width: 800px;
            height: 600px;
            border: 2px solid #ccc;
            margin: 20px 0;
        }
        
        .tasks-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
        }
        
        .connections-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: visible;
            z-index: 2;
        }
        
        .task-node {
            position: absolute;
            width: 150px;
            height: 60px;
            background: white;
            border: 2px solid #333;
            border-radius: 8px;
            padding: 10px;
            z-index: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            margin: 0 10px;
            padding: 10px 15px;
            background: #007cee;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        
        button:hover {
            background: #005bb5;
        }
        
        .info {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <h1>Debug Connection Lines</h1>
    
    <div class="info">
        <h3>Test Results:</h3>
        <div id="test-results">Starting tests...</div>
    </div>
    
    <div class="controls">
        <button onclick="drawBasicConnection()">Draw Basic Connection</button>
        <button onclick="drawWithTransform()">Draw With Transform</button>
        <button onclick="clearConnections()">Clear Connections</button>
        <button onclick="toggleVisibility()">Toggle SVG Visibility</button>
    </div>
    
    <div class="debug-container" id="container">
        <div class="tasks-layer" id="tasks-layer">
            <svg class="connections-layer" width="800" height="600" id="svg-layer">
                <defs>
                    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                     refX="10" refY="3.5" orient="auto">
                        <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
                    </marker>
                </defs>
                <g id="connections-group">
                    <!-- Connections will be drawn here -->
                </g>
            </svg>
            
            <div class="task-node" id="task1" style="transform: translate(100px, 100px);">Task 1</div>
            <div class="task-node" id="task2" style="transform: translate(400px, 200px);">Task 2</div>
        </div>
    </div>

    <script>
        const resultsDiv = document.getElementById('test-results');
        const connectionsGroup = document.getElementById('connections-group');
        const tasksLayer = document.getElementById('tasks-layer');
        const svgLayer = document.getElementById('svg-layer');
        
        function log(message) {
            resultsDiv.innerHTML += message + '<br>';
            console.log(message);
        }
        
        function clearConnections() {
            connectionsGroup.innerHTML = '';
            log('Connections cleared');
        }
        
        function drawBasicConnection() {
            clearConnections();
            
            // Get task positions
            const task1 = document.getElementById('task1');
            const task2 = document.getElementById('task2');
            
            // Simple coordinates
            const fromX = 100 + 150; // task1 x + width
            const fromY = 100 + 30;  // task1 y + height/2
            const toX = 400;         // task2 x
            const toY = 200 + 30;    // task2 y + height/2
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const d = `M ${fromX} ${fromY} C ${fromX + 50} ${fromY} ${toX - 50} ${toY} ${toX} ${toY}`;
            path.setAttribute('d', d);
            path.setAttribute('stroke', '#007cee');
            path.setAttribute('stroke-width', '3');
            path.setAttribute('fill', 'none');
            path.setAttribute('marker-end', 'url(#arrowhead)');
            
            connectionsGroup.appendChild(path);
            log(`Basic connection drawn: ${d}`);
            log(`SVG viewBox: ${svgLayer.getAttribute('width')} x ${svgLayer.getAttribute('height')}`);
        }
        
        function drawWithTransform() {
            clearConnections();
            
            // Apply transform to the tasks layer
            tasksLayer.style.transform = 'translate(50px, 50px) scale(1.2)';
            
            // Draw connection in the original coordinate space
            const fromX = 100 + 150;
            const fromY = 100 + 30;
            const toX = 400;
            const toY = 200 + 30;
            
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const d = `M ${fromX} ${fromY} C ${fromX + 50} ${fromY} ${toX - 50} ${toY} ${toX} ${toY}`;
            path.setAttribute('d', d);
            path.setAttribute('stroke', '#ff6b35');
            path.setAttribute('stroke-width', '3');
            path.setAttribute('fill', 'none');
            path.setAttribute('marker-end', 'url(#arrowhead)');
            
            connectionsGroup.appendChild(path);
            log(`Connection with transform drawn: ${d}`);
            log(`Tasks layer transform: ${tasksLayer.style.transform}`);
        }
        
        function toggleVisibility() {
            const currentDisplay = svgLayer.style.display;
            svgLayer.style.display = currentDisplay === 'none' ? 'block' : 'none';
            log(`SVG visibility toggled to: ${svgLayer.style.display || 'default'}`);
        }
        
        // Initial test
        setTimeout(() => {
            log('=== Initial State ===');
            log(`SVG layer found: ${!!svgLayer}`);
            log(`Connections group found: ${!!connectionsGroup}`);
            log(`Tasks layer found: ${!!tasksLayer}`);
            log(`SVG dimensions: ${svgLayer.getAttribute('width')} x ${svgLayer.getAttribute('height')}`);
            log('=== Ready for testing ===');
        }, 100);
    </script>
</body>
</html>
