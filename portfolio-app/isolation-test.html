<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Connection Test - Isolation</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #f0f0f0;
        }
        
        .test-container {
            position: relative;
            width: 800px;
            height: 600px;
            background: white;
            border: 2px solid #333;
            margin: 20px 0;
        }
        
        .task-node {
            position: absolute;
            width: 150px;
            height: 60px;
            background: #4f46e5;
            color: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 10;
        }
        
        .connections-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
            overflow: visible;
        }
        
        .task-connection {
            stroke: #10b981;
            stroke-width: 4;
            fill: none;
            stroke-linecap: round;
            marker-end: url(#arrowhead);
        }
        
        .debug-info {
            background: #fffbeb;
            border: 1px solid #fbbf24;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        button {
            padding: 10px 15px;
            margin: 5px;
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background: #3730a3;
        }
    </style>
</head>
<body>
    <h1>SVG Connection Test - Isolation</h1>
    
    <div class="debug-info">
        <h3>Test Purpose:</h3>
        <p>This test isolates the SVG connection drawing issue to determine if it's related to:</p>
        <ul>
            <li>CSS conflicts in the main application</li>
            <li>DOM structure complexity</li>
            <li>Transform positioning issues</li>
            <li>Z-index layering problems</li>
        </ul>
    </div>
    
    <button onclick="drawTestConnection()">Draw Test Connection</button>
    <button onclick="toggleTaskPositions()">Toggle Task Positions</button>
    <button onclick="inspectSVG()">Inspect SVG</button>
    <button onclick="clearConnections()">Clear Connections</button>
    
    <div class="test-container" id="testContainer">
        <!-- SVG Layer for connections -->
        <svg class="connections-layer" width="800" height="600">
            <defs>
                <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                        refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
                </marker>
            </defs>
            <g id="connectionsGroup">
                <!-- Connections will be drawn here -->
            </g>
        </svg>
        
        <!-- Task nodes -->
        <div class="task-node" id="task1" style="left: 50px; top: 100px;">Task 1</div>
        <div class="task-node" id="task2" style="left: 300px; top: 200px;">Task 2</div>
        <div class="task-node" id="task3" style="left: 550px; top: 300px;">Task 3</div>
    </div>
    
    <div class="debug-info" id="debugOutput">
        <h3>Debug Output:</h3>
        <pre id="debugText">Click "Inspect SVG" to see debug information...</pre>
    </div>

    <script>
        let useTransform = false;
        
        function drawTestConnection() {
            console.log('ðŸ§ª Drawing test connection...');
            
            const container = document.getElementById('testContainer');
            const connectionsGroup = document.getElementById('connectionsGroup');
            const task1 = document.getElementById('task1');
            const task2 = document.getElementById('task2');
            
            // Get positions
            const containerRect = container.getBoundingClientRect();
            const task1Rect = task1.getBoundingClientRect();
            const task2Rect = task2.getBoundingClientRect();
            
            // Calculate relative positions
            const fromX = (task1Rect.left - containerRect.left) + task1Rect.width;
            const fromY = (task1Rect.top - containerRect.top) + task1Rect.height / 2;
            const toX = task2Rect.left - containerRect.left;
            const toY = (task2Rect.top - containerRect.top) + task2Rect.height / 2;
            
            console.log(`Coordinates: from(${fromX}, ${fromY}) to(${toX}, ${toY})`);
            
            // Create path
            const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            const controlOffset = Math.abs(toX - fromX) * 0.4;
            const d = `M ${fromX} ${fromY} C ${fromX + controlOffset} ${fromY} ${toX - controlOffset} ${toY} ${toX} ${toY}`;
            
            path.setAttribute('d', d);
            path.setAttribute('class', 'task-connection');
            path.setAttribute('id', 'testConnection');
            
            connectionsGroup.appendChild(path);
            
            console.log('âœ… Connection added to DOM');
            updateDebugInfo();
        }
        
        function toggleTaskPositions() {
            useTransform = !useTransform;
            const tasks = document.querySelectorAll('.task-node');
            
            if (useTransform) {
                // Switch to transform positioning
                tasks.forEach((task, index) => {
                    const positions = [
                        { x: 50, y: 150 },
                        { x: 300, y: 250 },
                        { x: 550, y: 350 }
                    ];
                    
                    task.style.left = '';
                    task.style.top = '';
                    task.style.transform = `translate(${positions[index].x}px, ${positions[index].y}px)`;
                });
                console.log('ðŸ”„ Switched to transform positioning');
            } else {
                // Switch to left/top positioning
                tasks.forEach((task, index) => {
                    const positions = [
                        { left: 50, top: 100 },
                        { left: 300, top: 200 },
                        { left: 550, top: 300 }
                    ];
                    
                    task.style.transform = '';
                    task.style.left = positions[index].left + 'px';
                    task.style.top = positions[index].top + 'px';
                });
                console.log('ðŸ”„ Switched to left/top positioning');
            }
            
            updateDebugInfo();
        }
        
        function clearConnections() {
            const connectionsGroup = document.getElementById('connectionsGroup');
            connectionsGroup.innerHTML = '';
            console.log('ðŸ§¹ Connections cleared');
            updateDebugInfo();
        }
        
        function inspectSVG() {
            updateDebugInfo();
        }
        
        function updateDebugInfo() {
            const svg = document.querySelector('.connections-layer');
            const connectionsGroup = document.getElementById('connectionsGroup');
            const paths = connectionsGroup.querySelectorAll('path');
            
            let debugText = `SVG Element Analysis:\n`;
            debugText += `- Dimensions: ${svg.getAttribute('width')} x ${svg.getAttribute('height')}\n`;
            debugText += `- Client size: ${svg.clientWidth} x ${svg.clientHeight}\n`;
            debugText += `- Bounding rect: ${JSON.stringify(svg.getBoundingClientRect())}\n`;
            debugText += `- Computed styles:\n`;
            debugText += `  - display: ${getComputedStyle(svg).display}\n`;
            debugText += `  - visibility: ${getComputedStyle(svg).visibility}\n`;
            debugText += `  - opacity: ${getComputedStyle(svg).opacity}\n`;
            debugText += `  - z-index: ${getComputedStyle(svg).zIndex}\n`;
            debugText += `\nConnections Group:\n`;
            debugText += `- Children count: ${connectionsGroup.children.length}\n`;
            debugText += `- Paths count: ${paths.length}\n`;
            
            if (paths.length > 0) {
                paths.forEach((path, index) => {
                    const rect = path.getBoundingClientRect();
                    debugText += `\nPath ${index + 1}:\n`;
                    debugText += `  - d: ${path.getAttribute('d')}\n`;
                    debugText += `  - stroke: ${path.getAttribute('stroke')}\n`;
                    debugText += `  - Bounding rect: ${JSON.stringify(rect)}\n`;
                    debugText += `  - Computed stroke: ${getComputedStyle(path).stroke}\n`;
                    debugText += `  - Total length: ${path.getTotalLength()}\n`;
                });
            }
            
            debugText += `\nTask positioning mode: ${useTransform ? 'transform' : 'left/top'}\n`;
            
            document.getElementById('debugText').textContent = debugText;
        }
        
        // Initial debug info
        updateDebugInfo();
    </script>
</body>
</html>
